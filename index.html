<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>test in reatc</title>
    <link rel="stylesheet" href="./assets/styles/styles.css" />
  </head>
  <body>
    <div id="root"></div>
    <script src="https://unpkg.com/react@16.12.0/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@16.12.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.8.3/babel.js"></script>
    <script src="https://unpkg.com/prop-types@15.6.1/prop-types.js"></script>

    <script type="text/babel">
      const rootElement = document.getElementById("root");

      function App(props) {
        const [tasks, setTasks] = React.useState(props.tasks);
        console.log(props.tasks);

        const confirmTaskIsCompleted = (id) => {
          const newTasksList = tasks.map((task) => {
            if (id === task.id) {
              return { ...task, completed: !task.completed };
            }
            return task;
          });
          setTasks(newTasksList);
        };

        const deleteTask = (id) => {
          const tasksListUpdated = tasks.filter((task) => task.id !== id);
          setTasks(tasksListUpdated);
        };

        const editTask = (id, newName) => {
          const tasksListUpdateEdit = tasks.map((task) => {
            if (task.id !== id) {
              return { ...task, name: newName };
            }
            return task;
          });
          setTasks(tasksListUpdateEdit);
        };

        const tasksList = tasks.map((task) => (
          <Todo
            id={task.id}
            name={task.name}
            completed={task.completed}
            key={task.id}
            taskCompleted={confirmTaskIsCompleted}
            deleteTask={deleteTask}
            editTask={editTask}
          />
        ));

        let i = 4;
        const addTask = (name) => {
          const newTaskToAdd = { id: `${i++}`, name: name, completed: false };
          setTasks([...tasks, newTaskToAdd]);
        };

        console.log(tasksList.length);
        const textOnNumberOfTasks =
          tasksList.length !== 1 ? "remaining tasks" : "remaining task";
        const numberTasks = `${tasksList.length} ${textOnNumberOfTasks}`;

        return (
          <div className="todoapp stack-large">
            <h1>Todo List React Test</h1>
            <Form onAdd={addTask} />
            <div className="filters btn-group stack-exception">
              <FilterBtn />
              <FilterBtn />
              <FilterBtn />
            </div>
            <h2 id="list-heading">{numberTasks}</h2>
            <ul className="todo-list stack-large stack-exception">
              {tasksList}
            </ul>
          </div>
        );
      }

      const Todo = (props) => {
        const [willChange, setHasChange] = React.useState(false);
        const [oldName, setOldName] = React.useState("");
        const [newName, setNewName] = React.useState(props.name);

        const handleChange = (e) => {
          setNewName(event.target.value);
        };

        const handlesubmit = (e) => {
          e.preventDefault();
          if (!newName) {
            alert("Please enter a new name");
            e.target.focus();
          } else {
            props.editTask(props.id, newName);
            setNewName("");
          }
          setHasChange(false);
        };

        const forEdit = (
          <form className="stack-small" onSubmit={handlesubmit}>
            <div className="form-group">
              <label className="todo-label" htmlFor={props.id}>
                New name for {props.name}
              </label>
              <input
                id={props.id}
                className="todo-text"
                type="text"
                value={newName}
                onChange={handleChange}
              />
            </div>
            <div className="btn-group">
              <button
                type="button"
                className="btn todo-cancel"
                onClick={() => setHasChange(false)}
              >
                Cancel
              </button>
              <button type="submit" className="btn btn__primary todo-edit">
                Save
              </button>
            </div>
          </form>
        );
        const forNonEdit = (
          <div className="stack-small">
            <div className="c-cb">
              <input
                id={props.id}
                type="checkbox"
                defaultChecked={props.completed}
                onChange={() => props.toggleTaskCompleted(props.id)}
              />
              <label className="todo-label" htmlFor={props.id}>
                {props.name}
              </label>
            </div>
            <div className="btn-group">
              <button
                type="button"
                className="btn"
                onClick={() => setHasChange(true)}
              >
                Edit
              </button>
              <button
                type="button"
                className="btn btn__danger"
                onClick={() => props.deleteTask(props.id)}
              >
                Delete
              </button>
            </div>
          </div>
        );

        return (
          <li className="todo stack-small">
            {" "}
            {willChange ? forEdit : forNonEdit}
          </li>
        );
      };

      const Form = (props) => {
        const [name, setName] = React.useState("");

        const handlesubmit = (e) => {
          e.preventDefault();
          if (!name) {
            alert("No Empty Name of task allowed");
            e.target.focus();
          } else {
            props.onAdd(name);
          }
          setName("");
        };

        const handleChange = (e) => {
          console.log(e.target.value);
          setName(e.target.value);
        };

        return (
          <form onSubmit={handlesubmit}>
            <h2 className="label-wrapper">
              <label htmlFor="new-todo-input" className="label__lg">
                Add new task here
              </label>
            </h2>
            <input
              type="text"
              id="new-todo-input"
              className="input input__lg"
              name="text"
              autoComplete="off"
              value={name}
              onChange={handleChange}
            />
            <button type="submit" className="btn btn__primary btn__lg">
              Add
            </button>
          </form>
        );
      };

      const FilterBtn = () => {
        return (
          <button type="button" className="btn toggle-btn" aria-pressed="true">
            <span> All tasks</span>
          </button>
        );
      };

      const DATA = [
        { name: "Eat", complete: false, id: 0 },
        { name: "code", complete: false, id: 1 },
        { name: "sleep", complete: false, id: 2 },
        { name: "restart", complete: true, id: 3 },
      ];
      ReactDOM.render(<App tasks={DATA} />, rootElement);
    </script>
    <script src="./assets/scripts/index.js"></script>
  </body>
</html>
